<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Cache-Control" content="no-cache"> 
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta name="keywords" content="PHP,フレームワーク,MVC,軽量">
<meta name="description" content="軽量でシンプルなPHPのMVCフレームワーク">
<link rel="stylesheet" type="text/css" href="/css/jquery-ui/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="/css/layout.css" />
<link rel="stylesheet" type="text/css" href="/css/common.css" />
<link rel="stylesheet" type="text/css" href="/css/manual.css" />
<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/js/jquery-ui.js"></script>
<script type="text/javascript" src="/js/common.js"></script>
<title>軽量シンプルPHPフレームワーク | Curry</title>
</head>
<body>

<div id="header_frame">
  <div id="header_frame_inner">

    <div class="clear"></div>
    <h1 class="logo">Curry<br /><span>PHP Framework</span></h1>
    <ul id="main_menu">
          <li><a href="/reference">リファレンス</a></li>
          <li class="selected"><a href="/manual">マニュアル</a></li>
          <li><a href="/index">ホーム</a></li>
        </ul>
    <div class="clear"></div>
  </div>
</div>


<div id="main_frame">



  <div id="left_frame">

  <ul id="side_menu">
            <li><a href="/manual/about">Curryの特徴</a></li>
                <li><a href="/manual/introduction">導入</a></li>
                <li><a href="/manual/url">URL</a></li>
                <li><a href="/manual/dirs">ディレクトリ構成</a></li>
                <li><a href="/manual/naming">名前規則</a></li>
                <li class="selected"><a href="/manual/init">初期設定</a></li>
                <li><a href="/manual/controller">コントローラー</a></li>
                <li><a href="/manual/validate">バリデーション</a></li>
                <li><a href="/manual/error">エラー制御</a></li>
                <li><a href="/manual/model">モデル</a></li>
                <li><a href="/manual/data">データアクセス</a></li>
                <li><a href="/manual/view">ビュー</a></li>
                <li><a href="/manual/viewscript">ビュースクリプト</a></li>
                <li><a href="/manual/service">サービス</a></li>
                <li><a href="/manual/config">設定ファイル</a></li>
                <li><a href="/manual/customize">カスタマイズ</a></li>
                <li><a href="/manual/pager">ページング処理</a></li>
                <li><a href="/manual/log">ログ出力</a></li>
                <li><a href="/manual/rest">REST</a></li>
                <li><a href="/manual/html">HTML自動生成</a></li>
                <li><a href="/manual/form">フォーム自動生成</a></li>
          </ul>
  </div>
  
  <div id="right_frame">
    <h2>初期設定</h2>  
    <ul id="title_list">
                  <li><a href="#1">アプリケーションの初期設定</a></li>
                        <li><a href="#2">curry.iniによる初期設定</a></li>
                        <li><a href="#3">Initializerによる初期設定（ver.1.3.0以降）</a></li>
                        <li><a href="#4">index.phpでの初期設定</a></li>
                        <li><a href="#5">アプリケーション環境設定（ver.1.4.0以降）</a></li>
              </ul>

	      <h3 id="1">アプリケーションの初期設定</h3>
    		<p class="exp">
ここでいう初期設定とはアプリケーションのトップで行う、アプリケーション全体の基本動作を決める設定の事を指します。<br />
初期設定の方法は3通りがあります。<br />
一つはcurry.iniを使用した、設定ファイルによる初期設定です。通常はこれで設定します。<br />
もう一つはInitializerクラスによる初期設定です。<br />
最後の一つはindex.phpによる初期設定です。
</p>
				
	      <h3 id="2">curry.iniによる初期設定</h3>
    		<p class="exp">
最も簡単な設定方法です。<br />
設定できる項目の詳細については<a href="/manual/customize/">カスタマイズのマニュアル</a>を参照してください。<br />
フレームワークの基本動作に関する各種設定が行えます。
</p>
				
	      <h3 id="3">Initializerによる初期設定（ver.1.3.0以降）</h3>
    		<p class="exp">
初期設定用のクラス"Initializer"を使用した初期設定が可能です。<br />
Curryには初期設定用の基本クラス、InitializerStandardクラスが存在します。<br />
このクラスで行なっているのはcurry.iniでの設定を実際に適用することです。<br />
しかし、場合によって設定ファイルの設定値よりも優先して設定したい項目がある場合に便利なのがInitializerクラスを利用した初期設定です。<br />
Initializerクラスの利用方法は以下のとおりです。
</p>
				<ul class="kajo">
    <li>クラス名をInitializerとする</li>
    <li>InitializerStandardクラスを継承する</li>
    <li>アプリケーションディレクトリ直下に配置する（デフォルトではappディレクトリ）</li>
    <li>initializeメソッドを定義する</li>
</ul>
				<p class="exp">
以上の条件を満たすと、initializeメソッドが自動的に実行されます。<br />
実行タイミングはcurry.iniの設定適用の直後、URLルーティング処理の直前です。<br />
そのため、curry.iniで行った設定と同じ項目をInitializer::initializeメソッドで実行すると、後者が優先され、設定が上書きされます。<br />
<br />
以下の例では、curry.iniでデフォルトのアクションキーを"index"に設定していますが、Initializerで同じ設定を"default"にしているため、こちらが優先されます。
</p>
				<div class="file_name">
curry.ini
</div>
<div class="sample_code"><div>
<pre>
;--If you want to modify default action key, set this value.
default_action = &quot;index&quot;
</pre>
</div></div>
				<div class="file_name">
app/initializer.php
</div>
<div class="sample_code"><div>
<pre>
<span class="reserved">class</span> <span class="class">Initializer</span> <span class="reserved">extends</span> <span class="class">InitializerStandard</span>
{
    <span class="reserved">public</span> <span class="reserved">function</span> initialize()
    {
        $this-&gt;router-&gt;setDefaultAction(<span class="reteral">'default'</span>);
    }
}
</pre>
</div></div>
				
	      <h3 id="4">index.phpでの初期設定</h3>
    		<p class="exp">
例えばDb::isSingletonなど、静的な設定メソッドはindex.phpでの設定も可能です。<br />
しかしindex.phpでの設定はcurry.iniの適用より前のタイミングとなるため、curry.iniで設定した内容が優先されるため、index.phpでの設定はよほどの理由がない限りはやるべきではありません。<br />
特にver1.3.0以降はInitializer::initializeで同じ事ができ、curry.iniよりも優先されるため、そちらで行う事を推奨します。<br />

</p>
				
	      <h3 id="5">アプリケーション環境設定（ver.1.4.0以降）</h3>
    		<p class="exp">
Curryのバージョン1.4.0以降では、apacheの環境変数をもとにアプリケーションの動作環境を判別し、環境によって基本的な動作を切り分ける事ができます。<br />
これを利用すると環境による違いの設定やコーディングをあらかじめ記述しておくことで、動作環境によって自動的にそれらの処理が切り分けられるため、環境によるソースの差異を無くす事ができ、デプロイミスの発生を抑えることができます。<br />
<br />
この仕組みを利用するためにCurryが参照する環境変数は"APP_ENV"です。<br />
apacheのhttpd.conf、または.htaccessでこの環境変数を設定します。
</p>
				<div class="file_name">
site/htdocss/.htaccess
</div>
<div class="sample_code"><div>
<pre>
SetEnv APP_ENV product
#SetEnv APP_ENV develop
#SetEnv APP_ENV test
</pre>
</div></div>
				<p class="exp">
APP_ENVの値はなんでも構いませんが、Curryで推奨するのは以下の3つです。
</p>
				<ul class="kajo">
    <li>product（本番環境）</li>
    <li>develop（開発環境）</li>
    <li>test（テスト環境）</li>
</ul>
				<p class="exp">
環境変数ごとに切り分けが可能なのは以下の3点です。
</p>
				<ul class="kajo">
    <li>データベース接続設定</li>
    <li>エラーテンプレート</li>
    <li>初期設定クラスの初期化メソッド</li>
</ul>
				<h4>データベース接続設定</h4>
<p class="exp">
database.iniにはデータベース接続情報を設定しますが、環境変数APP_ENVの値と同じセクションでこれを定義することで、そのセクションを接続情報として参照します。<br />
つまり、復数の環境変数のセクションを定義しておけば、同じ内容のdatabase.iniでも環境によって接続先のデータベースを変えることができるわけです。
</p>
				<div class="file_name">
database.iniの設定例
</div>
<div class="sample_code"><div>
<pre>
[product]
type     = mysql
host     = localhost
dbname   = site_db
user     = 
password = 

[develop]
type     = mysql
host     = localhost
dbname   = site_db_dev
user     = 
password = 

[test]
type     = mysql
host     = localhost
dbname   = site_db_test
user     = 
password = 
</pre>
</div></div>
				<p class="exp">
バージョン1.4.0未満の場合はセクション名は"connection"固定のため、このような設定には対応していません。<br />
1.4.0以降でも"connection"セクションでの設定にも対応していますが、環境変数のセクションが定義されている場合はそちらが優先されます。1.4.0以降では環境変数セクションでの設定を推奨します。<br />
<span style="color:#ff0000;">※近い将来のバージョンでconnectionセクションでの設定の対応は削除される予定です。</a>
</p>
				<h4>エラーテンプレート</h4>
<p class="exp">

</p>
				<p class="exp">
例外発生時に表示されるテンプレートは、エラーテンプレートディレクトリ（デフォルトではapp/views/templates/error/）に格納されていますが、デフォルトでは環境変数APP_ENVの値と同じ名前のテンプレートをエラーテンプレートとして表示しようとします。つまり、環境変数ごとのテンプレートを用意しておくことで、環境によって表示させるエラーメッセージを変える事ができます。<br />
<br />
例えば本番環境では「システムエラーが発生しました」のような固定のエラーメッセージを表示するテンプレートにし、開発環境では例外の内容がわかるように例外情報を表示するテンプレートにするなどが可能になります。
</p>
				<div class="file_name">
app/views/templates/error/product.tpl
</div>
<div class="sample_code"><div>
<pre>
システムエラーが発生しました。
</pre>
</div></div>
				<div class="file_name">
app/views/templates/error/develop.tpl
</div>
<div class="sample_code"><div>
<pre>
<span class="reteral">{$file}</span>(<span class="reteral">{$line}</span>)
&lt;br /&gt;
<span class="reteral">{$message}</span>
&lt;br /&gt;&lt;br /&gt;
<span class="reteral">{$trace|nl2br}</span>
</pre>
</div></div>
				<p class="exp">
バージョン1.4.0未満の場合はエラーテンプレート名は"error"固定です。<br />
ViewAbstract::setErrorTemplateメソッドにより個別に設定は可能ですが、環境変数によって自動的に切り分けるような仕組みは存在しません。<br />
1.4.0以降でもエラーテンプレート名が"error"にも対応していますが、環境変数と一致するファイル名のテンプレートが存在する場合はそちらのが優先されます。1.4.0以降では環境変数のテンプレート名を推奨します。<br />
<span style="color:#ff0000;">※近い将来のバージョンで"error"という名前のエラーテンプレートへの対応は削除される予定です。</a>
</p>
				<h4>初期設定クラスの初期化メソッド</h4>
<p class="exp">
初期設定クラス、Initializerクラスに、環境変数APP_ENVの値に応じた、"init"で始まる名前のメソッドを定義すると、自動的にそのメソッドが実行されます。たとえばAPP_ENVが"product"であればinitProductメソッド、"develop"であればinitDevelopメソッドが実行されることになります。<br />
<br />
あらかじめ各環境変数値に対応するメソッドを全て定義しておけば、環境によって実行されるメソッドが切り分けられ、特定の環境でのみ行いたい処理などを定義することができます。<br />

</p>
				<div class="sample_code"><div>
<pre>
<span class="reserved">class</span> <span class="class">Initializer</span> <span class="reserved">extends</span> <span class="class">InitializerStandard</span>
{
    <span class="reserved">public</span> <span class="reserved">function</span> initProduct()
    {
        <span class="comment">// 本番環境のみ、カウンターを回す
</span>        Loader::loadLibrary(<span class="reteral">'Counter'</span>);
        $counter = <span class="reserved">new</span> Counter();
        $counter-&gt;increment();
    }
    
    <span class="reserved">public</span> <span class="reserved">function</span> initDevelop()
    {
        <span class="comment">// 開発環境のみ、PHPエラー出力
</span>        ini_set(&quot;display_errors&quot;, 1);
        error_reporting(E_ALL);
    }	
}
</pre>
</div></div>
				


  </div>

</div>
<div id="footer_frame">
Copyright(C) 2011 Curry PHP Framework developers. This software is released under the <a href="http://opensource.org/licenses/mit-license.php">MIT license</a>. 
</div>
</body>
</html>